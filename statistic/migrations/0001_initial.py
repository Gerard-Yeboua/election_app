# Generated by Django 6.0 on 2025-12-26 07:51

import django.db.models.deletion
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('geography', '0001_initial'),
        ('pv', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='SnapshotQuotidien',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date', models.DateField(db_index=True, unique=True)),
                ('total_bureaux', models.IntegerField(default=0)),
                ('total_inscrits', models.IntegerField(default=0)),
                ('total_pv_soumis', models.IntegerField(default=0)),
                ('total_pv_valides', models.IntegerField(default=0)),
                ('taux_soumission', models.FloatField(default=0)),
                ('taux_validation', models.FloatField(default=0)),
                ('total_votants', models.IntegerField(default=0)),
                ('taux_participation_global', models.FloatField(default=0)),
                ('total_incidents', models.IntegerField(default=0)),
                ('incidents_actifs', models.IntegerField(default=0)),
                ('taux_resolution', models.FloatField(default=0)),
                ('resultats_snapshot', models.JSONField(default=list, help_text='Snapshot des résultats principaux')),
                ('details_regions', models.JSONField(default=list, help_text='Détails statistiques par région')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
            ],
            options={
                'verbose_name': 'Snapshot quotidien',
                'verbose_name_plural': 'Snapshots quotidiens',
                'db_table': 'snapshots_quotidiens',
                'ordering': ['-date'],
            },
        ),
        migrations.CreateModel(
            name='CacheStatistique',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type_entite', models.CharField(choices=[('NATIONAL', 'National'), ('REGION', 'Région'), ('DEPARTEMENT', 'Département'), ('COMMUNE', 'Commune'), ('SOUS_PREFECTURE', 'Sous-préfecture'), ('LIEU_VOTE', 'Lieu de vote'), ('BUREAU_VOTE', 'Bureau de vote'), ('CANDIDAT', 'Candidat'), ('USER', 'Utilisateur')], help_text="Type d'entité concernée", max_length=20)),
                ('entite_id', models.CharField(db_index=True, help_text="ID de l'entité (UUID, code, 'national', etc.)", max_length=100)),
                ('type_statistique', models.CharField(choices=[('GENERAL', 'Statistiques générales'), ('PV', 'Statistiques PV'), ('PARTICIPATION', 'Statistiques participation'), ('INCIDENTS', 'Statistiques incidents'), ('RESULTATS', 'Résultats électoraux'), ('PERFORMANCE', 'Performance utilisateurs'), ('TIMELINE', 'Évolution temporelle')], help_text='Type de statistique', max_length=20)),
                ('cache_key', models.CharField(db_index=True, help_text='Clé unique: {type_entite}_{entite_id}_{type_statistique}', max_length=255, unique=True)),
                ('data', models.JSONField(default=dict, help_text='Données statistiques en JSON')),
                ('date_calcul', models.DateTimeField(auto_now=True, help_text='Date du dernier calcul')),
                ('duree_calcul_ms', models.IntegerField(blank=True, help_text='Durée du calcul en millisecondes', null=True)),
                ('ttl_minutes', models.IntegerField(default=60, help_text='Time To Live en minutes (durée de validité)')),
                ('date_expiration', models.DateTimeField(db_index=True, help_text="Date d'expiration du cache")),
                ('is_valid', models.BooleanField(default=True, help_text='False si le cache est invalidé')),
                ('force_refresh', models.BooleanField(default=False, help_text='True pour forcer le rafraîchissement au prochain accès')),
                ('hit_count', models.IntegerField(default=0, help_text="Nombre d'accès au cache")),
                ('last_accessed', models.DateTimeField(blank=True, help_text='Date du dernier accès', null=True)),
                ('version', models.IntegerField(default=1, help_text='Version du cache (incrémenté à chaque recalcul)')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Cache statistique',
                'verbose_name_plural': 'Caches statistiques',
                'db_table': 'cache_statistiques',
                'indexes': [models.Index(fields=['cache_key'], name='cache_stati_cache_k_e4cd66_idx'), models.Index(fields=['type_entite', 'entite_id'], name='cache_stati_type_en_46414d_idx'), models.Index(fields=['type_statistique'], name='cache_stati_type_st_a4529d_idx'), models.Index(fields=['date_expiration', 'is_valid'], name='cache_stati_date_ex_584ff0_idx'), models.Index(fields=['is_valid', 'force_refresh'], name='cache_stati_is_vali_6be66c_idx')],
                'unique_together': {('type_entite', 'entite_id', 'type_statistique')},
            },
        ),
        migrations.CreateModel(
            name='StatistiqueBureau',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('has_pv_valide', models.BooleanField(default=False)),
                ('pv_id', models.UUIDField(blank=True, null=True)),
                ('statut_pv', models.CharField(blank=True, max_length=20, null=True)),
                ('date_soumission_pv', models.DateTimeField(blank=True, null=True)),
                ('date_validation_pv', models.DateTimeField(blank=True, null=True)),
                ('nombre_votants', models.IntegerField(default=0)),
                ('suffrages_exprimes', models.IntegerField(default=0)),
                ('bulletins_nuls', models.IntegerField(default=0)),
                ('bulletins_blancs', models.IntegerField(default=0)),
                ('taux_participation', models.FloatField(default=0)),
                ('resultats_candidats', models.JSONField(default=list, help_text='Liste des résultats par candidat')),
                ('candidat_vainqueur', models.CharField(blank=True, max_length=200, null=True)),
                ('voix_vainqueur', models.IntegerField(default=0)),
                ('total_incidents', models.IntegerField(default=0)),
                ('incidents_ouverts', models.IntegerField(default=0)),
                ('incidents_critiques', models.IntegerField(default=0)),
                ('superviseur_nom', models.CharField(blank=True, max_length=200, null=True)),
                ('superviseur_id', models.UUIDField(blank=True, null=True)),
                ('derniere_activite', models.DateTimeField(blank=True, null=True)),
                ('date_calcul', models.DateTimeField(auto_now=True)),
                ('version', models.IntegerField(default=1)),
                ('bureau', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='statistiques', to='geography.bureauvote')),
            ],
            options={
                'verbose_name': 'Statistique bureau',
                'verbose_name_plural': 'Statistiques bureaux',
                'db_table': 'statistiques_bureaux',
            },
        ),
        migrations.CreateModel(
            name='StatistiqueCandidat',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('total_voix_national', models.IntegerField(default=0)),
                ('nombre_bureaux', models.IntegerField(default=0)),
                ('pourcentage_national', models.FloatField(default=0)),
                ('position_nationale', models.IntegerField(blank=True, null=True)),
                ('resultats_par_region', models.JSONField(default=list, help_text='Résultats détaillés par région')),
                ('meilleurs_bureaux', models.JSONField(default=list, help_text='Top 10 bureaux avec les meilleurs scores')),
                ('moyenne_voix_par_bureau', models.FloatField(default=0)),
                ('ecart_type', models.FloatField(blank=True, null=True)),
                ('score_minimum', models.IntegerField(default=0)),
                ('score_maximum', models.IntegerField(default=0)),
                ('evolution_7_jours', models.JSONField(default=list, help_text='Évolution des voix sur 7 jours')),
                ('date_calcul', models.DateTimeField(auto_now=True)),
                ('version', models.IntegerField(default=1)),
                ('candidat', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='statistiques', to='pv.candidat')),
            ],
            options={
                'verbose_name': 'Statistique candidat',
                'verbose_name_plural': 'Statistiques candidats',
                'db_table': 'statistiques_candidats',
            },
        ),
        migrations.CreateModel(
            name='StatistiquePerformance',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('total_pv_soumis', models.IntegerField(default=0)),
                ('pv_valides', models.IntegerField(default=0)),
                ('pv_rejetes', models.IntegerField(default=0)),
                ('taux_validation', models.FloatField(default=0)),
                ('delai_moyen_soumission', models.FloatField(blank=True, null=True)),
                ('incidents_signales', models.IntegerField(default=0)),
                ('incidents_critiques', models.IntegerField(default=0)),
                ('total_checkins', models.IntegerField(default=0)),
                ('duree_moyenne_presence', models.FloatField(blank=True, null=True)),
                ('pv_valides_admin', models.IntegerField(default=0)),
                ('pv_rejetes_admin', models.IntegerField(default=0)),
                ('delai_moyen_validation', models.FloatField(blank=True, null=True)),
                ('incidents_traites', models.IntegerField(default=0)),
                ('incidents_resolus', models.IntegerField(default=0)),
                ('taux_resolution_incidents', models.FloatField(default=0)),
                ('delai_moyen_resolution', models.FloatField(blank=True, null=True)),
                ('score_reactivite', models.FloatField(default=0)),
                ('score_qualite', models.FloatField(default=0)),
                ('score_global', models.FloatField(default=0)),
                ('rang_national', models.IntegerField(blank=True, null=True)),
                ('rang_regional', models.IntegerField(blank=True, null=True)),
                ('date_calcul', models.DateTimeField(auto_now=True)),
                ('version', models.IntegerField(default=1)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='statistiques_performance', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Statistique performance',
                'verbose_name_plural': 'Statistiques performance',
                'db_table': 'statistiques_performance',
                'ordering': ['-score_global'],
            },
        ),
        migrations.CreateModel(
            name='StatistiqueRegion',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('total_bureaux', models.IntegerField(default=0)),
                ('total_inscrits', models.IntegerField(default=0)),
                ('moyenne_inscrits_par_bureau', models.FloatField(default=0)),
                ('total_pv_soumis', models.IntegerField(default=0)),
                ('total_pv_valides', models.IntegerField(default=0)),
                ('total_pv_en_attente', models.IntegerField(default=0)),
                ('total_pv_rejetes', models.IntegerField(default=0)),
                ('taux_soumission', models.FloatField(default=0)),
                ('taux_validation', models.FloatField(default=0)),
                ('total_votants', models.IntegerField(default=0)),
                ('total_suffrages_exprimes', models.IntegerField(default=0)),
                ('total_bulletins_nuls', models.IntegerField(default=0)),
                ('total_bulletins_blancs', models.IntegerField(default=0)),
                ('taux_participation', models.FloatField(default=0)),
                ('taux_nuls', models.FloatField(default=0)),
                ('taux_blancs', models.FloatField(default=0)),
                ('total_incidents', models.IntegerField(default=0)),
                ('incidents_ouverts', models.IntegerField(default=0)),
                ('incidents_en_cours', models.IntegerField(default=0)),
                ('incidents_traites', models.IntegerField(default=0)),
                ('incidents_clos', models.IntegerField(default=0)),
                ('incidents_urgents', models.IntegerField(default=0)),
                ('taux_resolution_incidents', models.FloatField(default=0)),
                ('delai_moyen_resolution_incidents', models.FloatField(blank=True, null=True)),
                ('top_3_candidats', models.JSONField(default=list, help_text='Top 3 des candidats avec leurs scores')),
                ('date_calcul', models.DateTimeField(auto_now=True)),
                ('version', models.IntegerField(default=1)),
                ('region', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='statistiques', to='geography.region')),
            ],
            options={
                'verbose_name': 'Statistique région',
                'verbose_name_plural': 'Statistiques régions',
                'db_table': 'statistiques_regions',
            },
        ),
        migrations.CreateModel(
            name='LogRefreshStatistique',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('cache_key', models.CharField(max_length=255)),
                ('type_entite', models.CharField(max_length=20)),
                ('type_statistique', models.CharField(max_length=20)),
                ('statut', models.CharField(choices=[('SUCCESS', 'Succès'), ('ERROR', 'Erreur'), ('TIMEOUT', 'Timeout')], max_length=20)),
                ('message', models.TextField(blank=True, null=True)),
                ('duree_ms', models.IntegerField(help_text='Durée en millisecondes')),
                ('nombre_requetes_db', models.IntegerField(default=0)),
                ('triggered_by', models.CharField(help_text='Ce qui a déclenché le refresh (auto, manual, api, etc.)', max_length=50)),
                ('timestamp', models.DateTimeField(auto_now_add=True)),
                ('cache_statistique', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='logs_refresh', to='statistic.cachestatistique')),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Log refresh statistique',
                'verbose_name_plural': 'Logs refresh statistiques',
                'db_table': 'logs_refresh_statistiques',
                'ordering': ['-timestamp'],
                'indexes': [models.Index(fields=['cache_key', 'timestamp'], name='logs_refres_cache_k_c5ca25_idx'), models.Index(fields=['statut', 'timestamp'], name='logs_refres_statut_99f8e4_idx'), models.Index(fields=['duree_ms'], name='logs_refres_duree_m_cb4fbd_idx')],
            },
        ),
        migrations.CreateModel(
            name='StatistiqueTimeline',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type_timeline', models.CharField(choices=[('PV_SOUMISSIONS', 'Soumissions de PV'), ('PV_VALIDATIONS', 'Validations de PV'), ('INCIDENTS', 'Incidents'), ('PARTICIPATION', 'Participation'), ('RESULTATS', 'Résultats')], max_length=20)),
                ('granularite', models.CharField(choices=[('HEURE', 'Par heure'), ('JOUR', 'Par jour'), ('SEMAINE', 'Par semaine')], max_length=20)),
                ('date_debut', models.DateTimeField()),
                ('date_fin', models.DateTimeField()),
                ('data_points', models.JSONField(default=list, help_text='Liste des points de données [{date, valeur}, ...]')),
                ('total', models.IntegerField(default=0)),
                ('moyenne', models.FloatField(default=0)),
                ('minimum', models.IntegerField(default=0)),
                ('maximum', models.IntegerField(default=0)),
                ('date_calcul', models.DateTimeField(auto_now=True)),
                ('region', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='geography.region')),
            ],
            options={
                'verbose_name': 'Statistique timeline',
                'verbose_name_plural': 'Statistiques timeline',
                'db_table': 'statistiques_timeline',
                'indexes': [models.Index(fields=['type_timeline', 'granularite'], name='statistique_type_ti_7662b1_idx'), models.Index(fields=['date_debut', 'date_fin'], name='statistique_date_de_530787_idx'), models.Index(fields=['region'], name='statistique_region__e5a875_idx')],
            },
        ),
    ]
